!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e=e||self).ThreeInstancedParticles={},e.THREE)}(this,function(e,t){"use strict";var i=function(){function e(){this.position=new t.Vector3,this.quaternion=new t.Quaternion,this.scale=new t.Vector3}return e.compose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,i){var n=e.length,o=e.map(function(e){return e(t,function(){--n||i()})});return{pause:function(){return o.forEach(function(e){e&&e.pause()})}}}},e.prototype.start=function(e,t){var i=this;this.stop(),this.animation=e(this,function(){t(),i.animation=void 0})},e.prototype.stop=function(){this.animation&&!this.animation.pause&&console.log(this.animation),this.animation&&this.animation.pause()},e.prototype.dispose=function(){this.animation&&this.animation.pause(),this.animation=void 0},e.show=function(e,t){e.scale.set(1,1,1),t()},e.hide=function(e,t){e.scale.set(0,0,0),t()},e}(),n=function(){function e(){this.position=new t.Vector3,this.quaternion=new t.Quaternion,this.scale=new t.Vector3(1,1,1),this.matrix=new t.Matrix4,this.transition=new i,this.appended=!1}return e.prototype.append=function(e,t){this.appended=!0,this.transition.start(e||i.show,function(){t&&t()})},e.prototype.remove=function(e,t){var n=this;this.transition.start(e||i.hide,function(){n.appended=!1,t&&t()})},e.prototype.update=function(){return!!this.appended&&(this.matrix.compose(this.position.clone().add(this.transition.position),this.quaternion.clone().multiply(this.transition.quaternion),this.scale.clone().multiply(this.transition.scale)),!0)},e.prototype.dispose=function(){this.transition.dispose()},e}(),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var r,a=function(e,t,i){var n=i.get;i.get=function(){return Object.defineProperty(e,t,{value:n.call(e)})[t]}};!function(e){e[e.Append=1]="Append",e[e.Remove=-1]="Remove"}(r||(r={}));var s=function(e){function i(t){var i=void 0===t?{}:t,n=i.geometry,o=void 0===n?void 0:n,r=i.material,a=void 0===r?void 0:r,s=i.count,c=void 0===s?0:s,p=i.color,h=void 0===p?16777215:p,l=i.transition,u=void 0===l?{}:l,d=e.call(this)||this;return d.particles=[],d._usesNormalMaterial=!1,d.appendedParticles=0,d.transition=u,d.geometry=o,d.material=a,d.color=h,d.count=c,d}return function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(i,e),Object.defineProperty(i.prototype,"normalMaterial",{get:function(){return new t.MeshNormalMaterial({morphTargets:!0,skinning:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"generated",{get:function(){return!!this.mesh},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.mesh&&e&&(this.mesh.geometry=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e,this.mesh&&e&&(e.color.set(this.color),this.usesNormalMaterial||(this.mesh.material=e))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this.material&&this.material.color.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"usesNormalMaterial",{get:function(){return this._usesNormalMaterial},set:function(e){this._usesNormalMaterial=e,this.mesh&&(e||this.material)&&(this.mesh.material=e?this.normalMaterial:this.material)},enumerable:!0,configurable:!0}),i.prototype.createParticle=function(){return new n},i.prototype.prepareParticle=function(e,t){if(!this.mesh)throw new Error("The mesh and particles have not been generated, call generate() before calling appendParticle() or removeParticle()");var i;switch(e){case r.Append:if(this.appendedParticles>=this.mesh.count)throw new Error("All "+this.mesh.count+" particles have already been appended, increase count and call generate() to append more particles.");i=this.particles[this.appendedParticles++];break;case r.Remove:if(this.appendedParticles<=0)throw new Error("All "+this.mesh.count+" particles have already been removed, you cannot remove more particles.");i=this.particles[--this.appendedParticles]}return t&&t(i),i},i.prototype.generate=function(){if(!this.geometry||!this.material)throw new Error("geometry and material must be set before calling generate()");var e=this.particles,i=this.count;for(this.dispose(),this.mesh=new t.InstancedMesh(this.geometry,this.material,i),this.mesh.frustumCulled=!1,this.appendedParticles=Math.min(this.appendedParticles,i);e.length<i;)e.push(this.createParticle());e.splice(i).forEach(function(e){return e.dispose()}),this.add(this.mesh)},i.prototype.dispose=function(e){void 0===e&&(e=!1),this.mesh&&(this.remove(this.mesh),this.mesh=void 0),e&&this.particles.splice(0).forEach(function(e){return e.dispose()})},i.prototype.update=function(){if(this.mesh){var e=this.mesh;this.particles.forEach(function(t,i){t.update()&&(e.setMatrixAt(i,t.matrix),e.instanceMatrix.needsUpdate=!0)})}},i.prototype.appendParticle=function(e){var t=void 0===e?{}:e,i=t.prepare,n=void 0===i?void 0:i,o=t.complete,a=void 0===o?void 0:o,s=t.transition,c=void 0===s?this.transition.append:s;this.prepareParticle(r.Append,n).append(c,a)},i.prototype.removeParticle=function(e){var t=void 0===e?{}:e,i=t.prepare,n=void 0===i?void 0:i,o=t.complete,a=void 0===o?void 0:o,s=t.transition,c=void 0===s?this.transition.remove:s;this.prepareParticle(r.Remove,n).append(c,a)},function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);r>3&&a&&Object.defineProperty(t,i,a)}([a],i.prototype,"normalMaterial",null),i}(t.Object3D);e.Particle=n,e.ParticleSource=s,e.Transition=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map

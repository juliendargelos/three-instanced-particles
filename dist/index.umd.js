!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader"),require("three/examples/jsm/utils/BufferGeometryUtils")):"function"==typeof define&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader","three/examples/jsm/utils/BufferGeometryUtils"],t):t((e=e||self).ThreeInstancedParticles={},e.THREE,e.THREE.GLTFLoader,e.THREE.BufferGeometryUtils)}(this,function(e,t,r,i){"use strict";var o=function(){function e(){this.position=new t.Vector3,this.quaternion=new t.Quaternion,this.scale=new t.Vector3}return e.compose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,r){var i=e.length,o=e.map(function(e){return e(t,function(){--i||r()})});return{pause:function(){return o.forEach(function(e){e&&e.pause()})}}}},e.prototype.start=function(e,t){var r=this;this.stop(),this.animation=e(this,function(){t(),r.animation=void 0})},e.prototype.stop=function(){this.animation&&!this.animation.pause&&console.log(this.animation),this.animation&&this.animation.pause()},e.prototype.dispose=function(){this.animation&&this.animation.pause(),this.animation=void 0},e.show=function(e,t){e.scale.set(1,1,1),t()},e.hide=function(e,t){e.scale.set(0,0,0),t()},e}(),n=function(){function e(){this.position=new t.Vector3,this.quaternion=new t.Quaternion,this.scale=new t.Vector3(1,1,1),this.matrix=new t.Matrix4,this.transition=new o,this.appended=!1}return e.prototype.append=function(e,t){this.appended=!0,this.transition.start(e||o.show,function(){t&&t()})},e.prototype.remove=function(e,t){var r=this;this.transition.start(e||o.hide,function(){r.appended=!1,t&&t()})},e.prototype.update=function(){return!!this.appended&&(this.matrix.compose(this.position.clone().add(this.transition.position),this.quaternion.clone().multiply(this.transition.quaternion),this.scale.clone().multiply(this.transition.scale)),!0)},e.prototype.dispose=function(){this.transition.dispose()},e}(),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&(r[i[o]]=e[i[o]])}return r}var c,p=function(e,t,r){var i=r.get;r.get=function(){return Object.defineProperty(e,t,{value:i.call(e)})[t]}};!function(e){e[e.Append=1]="Append",e[e.Remove=-1]="Remove"}(c||(c={}));var l=function(e){function o(t){var r=void 0===t?{}:t,i=r.geometry,o=void 0===i?void 0:i,n=r.material,a=void 0===n?void 0:n,s=r.count,c=void 0===s?0:s,p=r.color,l=void 0===p?16777215:p,h=r.transition,u=void 0===h?{}:h,f=e.call(this)||this;return f.particles=[],f._usesNormalMaterial=!1,f.appendedParticles=0,f.transition=u,f.geometry=o,f.material=a,f.color=l,f.count=c,f}return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(o,e),Object.defineProperty(o.prototype,"normalMaterial",{get:function(){return new t.MeshNormalMaterial({morphTargets:!0,skinning:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"generated",{get:function(){return!!this.mesh},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e,this.mesh&&e&&(this.mesh.geometry=e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"material",{get:function(){return this._material},set:function(e){var t=this;this._material=e,this.mesh&&e&&(Array.isArray(e)?e.forEach(function(e){return e.color.set(t.color)}):e.color.set(this.color),this.usesNormalMaterial||(this.mesh.material=e))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this.material&&(Array.isArray(this.material)?this.material.forEach(function(t){return t.color.set(e)}):this.material.color.set(e))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"usesNormalMaterial",{get:function(){return this._usesNormalMaterial},set:function(e){this._usesNormalMaterial=e,this.mesh&&(e||this.material)&&(this.mesh.material=e?this.normalMaterial:this.material)},enumerable:!0,configurable:!0}),o.prototype.createParticle=function(){return new n},o.prototype.prepareParticle=function(e,t){if(!this.mesh)throw new Error("The mesh and particles have not been generated, call generate() before calling appendParticle() or removeParticle()");var r;switch(e){case c.Append:if(this.appendedParticles>=this.mesh.count)throw new Error("All "+this.mesh.count+" particles have already been appended, increase count and call generate() to append more particles.");r=this.particles[this.appendedParticles++];break;case c.Remove:if(this.appendedParticles<=0)throw new Error("All "+this.mesh.count+" particles have already been removed, you cannot remove more particles.");r=this.particles[--this.appendedParticles]}return t&&t(r),r},o.prototype.useGLTF=function(e){var t=function(e){var t=[],r=[];if(e.scene.traverse(function(e){e.isMesh&&(e.updateMatrixWorld(!0),e.geometry.applyMatrix(e.matrixWorld),t.push(e.geometry),r.push(e.material))}),!t.length)throw new Error("Could not find any geometry in GLTF scene");return{geometry:1===t.length?t[0]:i.BufferGeometryUtils.mergeBufferGeometries(t,!0),material:1===r.length?r[0]:r}}(e),r=t.geometry,o=t.material;this.geometry=r,this.material=o},o.prototype.loadGLTF=function(e,t){var i=this;(new r.GLTFLoader).load(e,function(e){i.useGLTF(e),t&&t(e)})},o.prototype.generate=function(){if(!this.geometry||!this.material)throw new Error("geometry and material must be set before calling generate()");var e=this.particles,r=this.count;for(this.dispose(),this.mesh=new t.InstancedMesh(this.geometry,this.material,r),this.mesh.frustumCulled=!1,this.appendedParticles=Math.min(this.appendedParticles,r);e.length<r;)e.push(this.createParticle());e.splice(r).forEach(function(e){return e.dispose()}),this.add(this.mesh)},o.prototype.dispose=function(e){void 0===e&&(e=!1),this.mesh&&(this.remove(this.mesh),this.mesh=void 0),e&&this.particles.splice(0).forEach(function(e){return e.dispose()})},o.prototype.update=function(){if(this.mesh){var e=this.mesh;this.particles.forEach(function(t,r){t.update()&&(e.setMatrixAt(r,t.matrix),e.instanceMatrix.needsUpdate=!0)})}},o.prototype.appendParticle=function(e){var t=void 0===e?{}:e,r=t.prepare,i=void 0===r?void 0:r,o=t.complete,n=void 0===o?void 0:o,a=t.transition,s=void 0===a?this.transition.append:a;this.prepareParticle(c.Append,i).append(s,n)},o.prototype.removeParticle=function(e){var t=void 0===e?{}:e,r=t.prepare,i=void 0===r?void 0:r,o=t.complete,n=void 0===o?void 0:o,a=t.transition,s=void 0===a?this.transition.remove:a;this.prepareParticle(c.Remove,i).append(s,n)},o.prototype.appendParticles=function(e){void 0===e&&(e={});var t=e.amount,r=void 0===t?1/0:t,i=s(e,["amount"]);r=Math.min(r,this.count-this.appendedParticles);for(var o=0;o<r;o++)this.appendParticle(i)},o.prototype.removeParticles=function(e){void 0===e&&(e={});var t=e.amount,r=void 0===t?1/0:t,i=s(e,["amount"]);r=Math.min(r,this.appendedParticles);for(var o=0;o<r;o++)this.removeParticle(i)},function(e,t,r,i){var o,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(n<3?o(a):n>3?o(t,r,a):o(t,r))||a);n>3&&a&&Object.defineProperty(t,r,a)}([p],o.prototype,"normalMaterial",null),o}(t.Object3D);e.Particle=n,e.ParticleSource=l,e.Transition=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map

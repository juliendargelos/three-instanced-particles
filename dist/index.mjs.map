{"version":3,"file":"index.mjs","sources":["../src/transition.ts","../src/particle.ts","../src/utils.ts","../src/particle-source.ts"],"sourcesContent":["import { Vector3, Quaternion } from 'three'\nimport { ParticleState } from '~/particle'\n\nexport interface Pausable {\n  pause(): void\n}\n\nexport type TransitionExecutor = (\n  transition: ParticleState,\n  complete: () => void\n) => Pausable | void | undefined\n\nexport class Transition implements ParticleState {\n  private animation?: Pausable\n  public readonly position: Vector3 = new Vector3()\n  public readonly quaternion: Quaternion = new Quaternion()\n  public readonly scale: Vector3 = new Vector3()\n\n  public static show: TransitionExecutor = (transition, complete) => {\n    transition.scale.set(1, 1, 1)\n    complete()\n  }\n\n  public static hide: TransitionExecutor = (transition, complete) => {\n    transition.scale.set(0, 0, 0)\n    complete()\n  }\n\n  public static compose(\n    ...executors: TransitionExecutor[]\n  ): TransitionExecutor {\n    return (transition: ParticleState, complete: () => void): Pausable => {\n      let animationsToComplete = executors.length\n      const animations = executors.map(executor => executor(transition, () => {\n        --animationsToComplete || complete()\n      }))\n\n      return {\n        pause: () => animations.forEach(animation => {\n          animation && animation.pause()\n        })\n      }\n    }\n  }\n\n  public start(executor: TransitionExecutor, complete: () => void): void {\n    this.stop()\n    this.animation = executor(this, () => {\n      complete()\n      this.animation = undefined\n    }) as Pausable | undefined\n  }\n\n  public stop(): void {\n    if (this.animation && !this.animation.pause) console.log(this.animation)\n    this.animation && this.animation.pause()\n  }\n\n  public dispose(): void {\n    this.animation && this.animation.pause()\n    this.animation = undefined\n  }\n}\n","import { Vector3, Quaternion, Matrix4 } from 'three'\nimport { Transition, TransitionExecutor } from '~/transition'\n\nexport interface ParticleState {\n  position: Vector3\n  quaternion: Quaternion\n  scale: Vector3\n}\n\nexport class Particle implements ParticleState {\n  public readonly position: Vector3 = new Vector3()\n  public readonly quaternion: Quaternion = new Quaternion()\n  public readonly scale: Vector3 = new Vector3(1, 1, 1)\n  public readonly matrix: Matrix4 = new Matrix4()\n  public readonly transition: Transition = new Transition()\n  public appended: boolean = false\n\n  public append(transition?: TransitionExecutor, complete?: () => void): void {\n    this.appended = true\n    this.transition.start(transition || Transition.show, () => {\n      complete && complete()\n    })\n  }\n\n  public remove(transition?: TransitionExecutor, complete?: () => void): void {\n    this.transition.start(transition || Transition.hide, () => {\n      this.appended = false\n      complete && complete()\n    })\n  }\n\n  public update(): boolean {\n    if (!this.appended) return false\n\n    this.matrix.compose(\n      this.position.clone().add(this.transition.position),\n      this.quaternion.clone().multiply(this.transition.quaternion),\n      this.scale.clone().multiply(this.transition.scale)\n    )\n\n    return true\n  }\n\n  public dispose(): void {\n    this.transition.dispose()\n  }\n}\n","import { BufferGeometry, Material, Object3D, Mesh, Color } from 'three'\nimport { GLTF } from 'three/examples/jsm/loaders/GLTFLoader'\n\nimport {\n  BufferGeometryUtils\n} from 'three/examples/jsm/utils/BufferGeometryUtils'\n\nexport type ColoredMaterial = Material & { color: Color }\n\nexport const lazy = (\n  target: object,\n  property: string,\n  descriptor: PropertyDescriptor\n): void => {\n  const get = descriptor.get!\n\n  descriptor.get = () => Object.defineProperty(target, property, {\n    value: get.call(target)\n  })[property]\n}\n\nexport const isMesh = (object: Object3D): object is Mesh => (\n  (object as unknown as Mesh).isMesh\n)\n\nexport const mergeGLTF = (gltf: GLTF): {\n  geometry: BufferGeometry\n  material: ColoredMaterial | ColoredMaterial[]\n} => {\n  const geometries: BufferGeometry[] = []\n  const materials: ColoredMaterial[] = []\n\n  gltf.scene.traverse((mesh) => {\n    if (!isMesh(mesh)) return\n\n    mesh.updateMatrixWorld(true)\n    mesh.geometry.applyMatrix(mesh.matrixWorld)\n\n    geometries.push(mesh.geometry as BufferGeometry)\n    materials.push(mesh.material as ColoredMaterial)\n  })\n\n  if (!geometries.length) throw new Error(\n    'Could not find any geometry in GLTF scene'\n  )\n\n  return {\n    geometry: geometries.length === 1\n      ? geometries[0]\n      : BufferGeometryUtils.mergeBufferGeometries(geometries, true),\n\n    material: materials.length === 1\n      ? materials[0]\n      : materials\n  }\n}\n","import {\n  Color,\n  Object3D,\n  Geometry,\n  BufferGeometry,\n  InstancedMesh,\n  MeshNormalMaterial\n} from 'three'\n\nimport { GLTF, GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { Particle } from '~/particle'\nimport { TransitionExecutor } from '~/transition'\nimport { lazy, mergeGLTF, ColoredMaterial } from '~/utils'\n\nenum ParticleSourceMutation {\n  Append = 1,\n  Remove = -1\n}\n\ninterface ParticleSourceTransitionExecutors {\n  append?: TransitionExecutor\n  remove?: TransitionExecutor\n}\n\ninterface ParticleSourceMutationExecutors {\n  prepare?: (particle: Particle) => void\n  complete?: () => void\n  transition?: TransitionExecutor\n}\n\nexport class ParticleSource extends Object3D {\n  private particles: Particle[] = []\n  private mesh?: InstancedMesh\n  private normalMesh?: InstancedMesh\n  private _geometry?: Geometry | BufferGeometry\n  private _material?: ColoredMaterial | ColoredMaterial[]\n  private _color!: Color | number\n  private _usesNormalMaterial: boolean = false\n\n  public appendedParticles: number = 0\n  public transition: ParticleSourceTransitionExecutors\n  public count: number\n\n  public constructor({\n    geometry = undefined,\n    material = undefined,\n    count = 0,\n    color = 0xffffff,\n    transition = {}\n  }: {\n    geometry?: Geometry | BufferGeometry\n    material?: ColoredMaterial | ColoredMaterial[]\n    count?: number\n    color?: Color | number\n    transition?: ParticleSourceTransitionExecutors\n  } = {}) {\n    super()\n\n    this.transition = transition\n    this.geometry = geometry\n    this.material = material\n    this.color = color\n    this.count = count\n  }\n\n  @lazy private get normalMaterial(): MeshNormalMaterial {\n    return new MeshNormalMaterial({\n      morphTargets: true,\n      skinning: true\n    })\n  }\n\n  public get generated(): boolean {\n    return !!this.mesh\n  }\n\n  public get geometry(): Geometry | BufferGeometry | undefined {\n    return this._geometry\n  }\n\n  public set geometry(v: Geometry | BufferGeometry | undefined) {\n    this._geometry = v\n    if (!this.mesh || !v) return\n    this.mesh.geometry = v\n  }\n\n  public get material(): ColoredMaterial | ColoredMaterial[] | undefined {\n    return this._material\n  }\n\n  public set material(v: ColoredMaterial | ColoredMaterial[] | undefined) {\n    this._material = v\n    if (!this.mesh || !v) return\n\n    if (Array.isArray(v)) {\n      v.forEach(material => material.color.set(this.color as Color))\n    } else {\n      v.color.set(this.color as Color)\n    }\n\n    if (!this.usesNormalMaterial) this.mesh.material = v\n  }\n\n  public get color(): Color | number {\n    return this._color\n  }\n\n  public set color(v: Color | number) {\n    this._color = v\n\n    if (!this.material) return\n\n    if (Array.isArray(this.material)) {\n      this.material.forEach(material => material.color.set(v as Color))\n    } else {\n      this.material.color.set(v as Color)\n    }\n  }\n\n  public get usesNormalMaterial(): boolean {\n    return this._usesNormalMaterial\n  }\n\n  public set usesNormalMaterial(v: boolean) {\n    this._usesNormalMaterial = v\n    if (!this.mesh || (!v && !this.material)) return\n    this.mesh.material = v ? this.normalMaterial : this.material!\n  }\n\n  protected createParticle(): Particle {\n    return new Particle()\n  }\n\n  protected prepareParticle(\n    mutation: ParticleSourceMutation,\n    prepare?: (particle: Particle) => void\n  ): Particle {\n    if (!this.mesh) throw new Error(\n      'The mesh and particles have not been generated, ' +\n      'call generate() before calling appendParticle() or removeParticle()'\n    )\n\n    let particle!: Particle\n\n    switch (mutation) {\n      case ParticleSourceMutation.Append:\n        if (this.appendedParticles >= this.mesh.count) throw new Error(\n          `All ${this.mesh.count} particles have already been appended, ` +\n          'increase count and call generate() to append more particles.'\n        )\n\n        particle = this.particles[this.appendedParticles++]\n\n        break\n\n      case ParticleSourceMutation.Remove:\n        if (this.appendedParticles <= 0) throw new Error(\n          `All ${this.mesh.count} particles have already been removed, ` +\n          'you cannot remove more particles.'\n        )\n\n        particle = this.particles[--this.appendedParticles]\n\n        break\n    }\n\n    prepare && prepare(particle)\n\n    return particle\n  }\n\n  public useGLTF(gltf: GLTF): void {\n    const { geometry, material } = mergeGLTF(gltf)\n\n    this.geometry = geometry\n    this.material = material\n  }\n\n  public loadGLTF(url: string, complete?: (gltf: GLTF) => void): void {\n    new GLTFLoader().load(url, (gltf) => {\n      this.useGLTF(gltf)\n      complete && complete(gltf)\n    })\n  }\n\n  public generate(): void {\n    if (!this.geometry || !this.material) throw new Error(\n      'geometry and material must be set before calling generate()'\n    )\n\n    const {\n      particles,\n      count\n    } = this\n\n    this.dispose()\n\n    this.mesh = new InstancedMesh(this.geometry, this.material, count)\n    this.mesh.frustumCulled = false\n\n    this.appendedParticles = Math.min(this.appendedParticles, count)\n    while (particles.length < count) particles.push(this.createParticle())\n    particles.splice(count).forEach(particle => particle.dispose())\n\n    this.add(this.mesh)\n  }\n\n  public dispose(all: boolean = false): void {\n    if (this.mesh) {\n      this.remove(this.mesh)\n      this.mesh = undefined\n    }\n\n    if (all) {\n      this.particles.splice(0).forEach(particle => particle.dispose())\n    }\n  }\n\n  public update(): void {\n    if (!this.mesh) return\n\n    const mesh = this.mesh\n\n    this.particles.forEach((particle, index) => {\n      if (!particle.update()) return\n      mesh.setMatrixAt(index, particle.matrix)\n      mesh.instanceMatrix.needsUpdate = true\n    })\n  }\n\n  public appendParticle({\n    prepare = undefined,\n    complete = undefined,\n    transition = this.transition.append\n  }: ParticleSourceMutationExecutors = {}): void {\n    this\n      .prepareParticle(ParticleSourceMutation.Append, prepare)\n      .append(transition, complete)\n  }\n\n  public removeParticle({\n    prepare = undefined,\n    complete = undefined,\n    transition = this.transition.remove\n  }: ParticleSourceMutationExecutors = {}): void {\n    this\n      .prepareParticle(ParticleSourceMutation.Remove, prepare)\n      .append(transition, complete)\n  }\n\n  public appendParticles({\n    amount = Infinity,\n    ...executors\n  }: ParticleSourceMutationExecutors & { amount?: number } = {}): void {\n    amount = Math.min(amount, this.count - this.appendedParticles)\n    for (var i = 0; i < amount; i++) this.appendParticle(executors)\n  }\n\n  public removeParticles({\n    amount = Infinity,\n    ...executors\n  }: ParticleSourceMutationExecutors & { amount?: number } = {}): void {\n    amount = Math.min(amount, this.appendedParticles)\n    for (var i = 0; i < amount; i++) this.removeParticle(executors)\n  }\n}\n"],"names":["tslib_1.__extends","tslib_1.__decorate"],"mappings":"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"}